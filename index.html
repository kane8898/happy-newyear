<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>新年快乐</title>

<style>
body{
  margin:0;
  overflow:hidden;
  background:#000;
  font-family: "Microsoft YaHei", sans-serif;
  color:white;
}
canvas{
  position:absolute;
  top:0;
  left:0;
}
.text{
  position:absolute;
  width:100%;
  top:40%;
  text-align:center;
  font-size:10vw;
  opacity:0;
  transition:opacity 2s;
  text-shadow:0 0 20px #fff,0 0 60px gold;
}
.sub{
  font-size:5vw;
}
.countdown{
  position:absolute;
  bottom:40px;
  width:100%;
  text-align:center;
  font-size:5vw;
}
</style>
</head>
<body>

<canvas id="canvas"></canvas>

<div class="text" id="greet">
  新年快乐
  <div class="sub">万事胜意</div>
</div>

<div class="countdown" id="countdown"></div>

<audio id="bgm" src="https://cdn.pixabay.com/audio/2022/11/03/audio_7c4f04c0a3.mp3" loop></audio>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let particles=[];
let fireworks=[];
let greetingShown=false;

function random(min,max){return Math.random()*(max-min)+min;}

class Firework{
  constructor(x,y){
    this.x=canvas.width/2;
    this.y=canvas.height;
    this.tx=x;
    this.ty=y;
    this.angle=Math.atan2(y-this.y,x-this.x);
    this.speed=6;
  }
  update(){
    this.x+=Math.cos(this.angle)*this.speed;
    this.y+=Math.sin(this.angle)*this.speed;
    if(Math.hypot(this.x-this.tx,this.y-this.ty)<10){
      explode(this.tx,this.ty);
      return true;
    }
    return false;
  }
  draw(){
    ctx.beginPath();
    ctx.arc(this.x,this.y,3,0,Math.PI*2);
    ctx.fillStyle="white";
    ctx.fill();
  }
}

class Particle{
  constructor(x,y){
    this.x=x;
    this.y=y;
    this.angle=random(0,Math.PI*2);
    this.speed=random(2,6);
    this.life=100;
    this.color=`hsl(${random(0,360)},100%,60%)`;
  }
  update(){
    this.x+=Math.cos(this.angle)*this.speed;
    this.y+=Math.sin(this.angle)*this.speed;
    this.speed*=0.96;
    this.life--;
  }
  draw(){
    ctx.beginPath();
    ctx.arc(this.x,this.y,2,0,Math.PI*2);
    ctx.fillStyle=this.color;
    ctx.fill();
  }
}

function explode(x,y){
  for(let i=0;i<120;i++){
    particles.push(new Particle(x,y));
  }
  if(!greetingShown){
    document.getElementById("greet").style.opacity=1;
    greetingShown=true;
  }
}

function animate(){
  requestAnimationFrame(animate);
  ctx.fillStyle="rgba(0,0,0,0.2)";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  fireworks=fireworks.filter(f=>{
    f.draw();
    return !f.update();
  });

  particles=particles.filter(p=>{
    p.update();
    p.draw();
    return p.life>0;
  });
}

function launchRandom(){
  fireworks.push(new Firework(random(200,canvas.width-200),random(100,canvas.height/2)));
}

setInterval(launchRandom,2000);
animate();

window.addEventListener("resize",()=>{
  canvas.width=window.innerWidth;
  canvas.height=window.innerHeight;
});

/* 倒计时（改日期即可） */
const targetDate = new Date("2026-01-01 00:00:00").getTime();
const countdownEl=document.getElementById("countdown");

setInterval(()=>{
  const now=Date.now();
  const diff=targetDate-now;
  if(diff<=0){
    countdownEl.innerText="新年到！";
    return;
  }
  const d=Math.floor(diff/1000/60/60/24);
  const h=Math.floor(diff/1000/60/60)%24;
  const m=Math.floor(diff/1000/60)%60;
  const s=Math.floor(diff/1000)%60;
  countdownEl.innerText=`倒计时 ${d}天 ${h}小时 ${m}分 ${s}秒`;
},1000);

/* 微信自动播放适配 */
function autoPlay(){
  const audio=document.getElementById("bgm");
  audio.play().catch(()=>{});
}
document.addEventListener("WeixinJSBridgeReady",autoPlay,false);
document.addEventListener("DOMContentLoaded",autoPlay);
</script>

</body>
</html>
